<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>KBC - Gen AI Mastery Edition & Squid Game Doll</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #001f3f;
            color: #c0c0c0;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex; /* Use flexbox for layout */
            justify-content: flex-start; /* Align items to the start */
            align-items: stretch; /* Stretch items to fill the container height */
            overflow: hidden; /* Prevent body scroll */
        }
        canvas {
            width: 25vw; /* GLB model takes 25% width */
            height: 100vh;
            display: block;
        }
        .quiz-container-wrapper {
            width: 75vw; /* Quiz takes 75% width */
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-y: auto; /* Allow scrolling for quiz content if needed */
        }
        .container {
            display: none;
            flex-direction: row;
            width: 95%;
            max-width: 1200px;
            gap: 20px;
        }
        .welcome-screen {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        .welcome-logo {
            font-size: 3em;
            color: gold;
        }
        .start-btn {
            background-color: gold;
            color: black;
            font-size: 1.2em;
            font-weight: bold;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        .game-container {
            background-color: #003366;
            border-radius: 10px;
            padding: 20px;
            flex: 2;
            box-shadow: 0 0 20px #ffd700;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .progress-bar-container {
            background: #000;
            border: 2px solid gold;
            border-radius: 8px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        .progress-bar {
            height: 20px;
            width: 0%;
            background: limegreen;
            transition: width 0.5s ease;
        }
        .badge {
            font-size: 1.2em;
            color: gold;
            text-align: center;
            margin: 10px 0;
            height: 24px;
        }
        .question {
            font-size: 1.5em;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid gold;
            border-radius: 8px;
            background-color: #002b5c;
            color: silver;
        }
        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .option-btn {
            background-color: #004080;
            color: #ffffff;
            border: 2px solid gold;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }
        .option-btn:hover {
            background-color: #0059b3;
        }
        .lifelines, .actions {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .lifeline-btn, .action-btn {
            background-color: gold;
            color: black;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            flex: 1;
        }
        .lifeline-btn:disabled {
            background-color: gray;
            cursor: not-allowed;
        }
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 1.2em;
            color: #ffd700;
        }
        .ladder {
            flex: 1;
            background-color: #002b5c;
            border-radius: 10px;
            padding: 15px;
            color: #ffd700;
            font-weight: bold;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 0 10px gold;
        }
        .ladder ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .ladder li {
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 5px;
            border: 1px solid gold;
            background-color: #004080;
        }
        .ladder .active {
            background-color: gold;
            color: black;
        }

        .final-congrats {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            color: gold;
            padding: 20px;
        }
        .badge-row {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin: 10px 0;
            gap: 15px;
        }
        .badge-box {
            border: 2px solid gold;
            padding: 10px 20px;
            border-radius: 10px;
            background-color: #002b5c;
            font-size: 1.1em;
        }
        .final-badge {
            font-size: 1.5em;
            font-weight: bold;
            background-color: gold;
            color: black;
            padding: 20px 40px;
            border-radius: 12px;
            border: 3px solid white;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <canvas id="glb-canvas"></canvas>

    <div class="quiz-container-wrapper">
        <div class="welcome-screen" id="welcome-screen">
            <div class="welcome-logo">üåü KBC - Gen AI & Tech Edition</div>
            <button class="start-btn" onclick="startGame()">‚ñ∂Ô∏è Start Game</button>
        </div>

        <div class="container" id="game-container">
            <div class="game-container">
                <div class="progress-bar-container"><div class="progress-bar" id="progress-bar"></div></div>
                <div class="badge" id="badge-msg"></div>
                <div class="lifelines">
                    <button class="lifeline-btn" onclick="use5050()" id="lifeline5050">50:50</button>
                    <button class="lifeline-btn" onclick="usePhone()" id="lifelinePhone">Phone</button>
                    <button class="lifeline-btn" onclick="useAudience()" id="lifelineAudience">Audience</button>
                </div>
                <div class="top-bar">
                    <div id="difficulty">üîé Difficulty: Easy</div>
                    <div id="timer">‚è±Ô∏è 30s</div>
                </div>
                <div class="question" id="question">Loading...</div>
                <div class="options" id="options"></div>
                <div class="actions">
                    <button class="action-btn" onclick="restartGame()">üîÅ Restart</button>
                    <button class="action-btn" onclick="quitGame()">üö™ Quit</button>
                    </div>
            </div>
            <div class="ladder" id="ladder-panel">
                <h3 style="text-align:center; margin-bottom: 10px;">üåê AI Mastery Ladder</h3>
                <ul id="ladder"></ul>
            </div>
        </div>
    </div>

    <audio id="soundQuestion" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>
    <audio id="soundCorrect" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>
    <audio id="soundWrong" src="https://actions.google.com/sounds/v1/cartoon/boing.ogg" preload="auto"></audio>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // KBC Quiz Script
        const prizes = [
            "üë∂ Beginner",
            "üìò AI Student",
            "üî¨ Tech Enthusiast",
            "üß± Model Builder",
            "üõ†Ô∏è Python Coder",
            "üßÆ Algorithm Crafter",
            "üîç AI Researcher",
            "üíæ Neural Network Designer",
            "üì° Data Science Analyst",
            "üöÄ Machine Learning Specialist",
            "ü™ê Deep Learning Expert",
            "üß† AI Tech Master"
        ];

        const allQuestions = [
            { q: "Which company developed GPT-4?", a: ["Google", "OpenAI", "Meta", "IBM"], c: 1, d: "easy" },
            { q: "What does AI stand for?", a: ["Automated Input", "Artificial Intelligence", "Advanced Interface", "Analog Input"], c: 1, d: "easy" },
            { q: "Primary language for TensorFlow?", a: ["Java", "C++", "Python", "Ruby"], c: 2, d: "medium" },
            { q: "Purpose of GPU in AI?", a: ["Power", "Rendering", "Parallel processing", "Memory"], c: 2, d: "medium" },
            { q: "Facebook AI framework?", a: ["Keras", "Theano", "PyTorch", "CNTK"], c: 2, d: "medium" },
            { q: "NLP stands for?", a: ["Neural LP", "Natural Language Processing", "Net Language Python", "None"], c: 1, d: "easy" },
            { q: "Image recognition model?", a: ["CNN", "RNN", "GAN", "MLP"], c: 0, d: "medium" },
            { q: "Google‚Äôs AI assistant?", a: ["Alexa", "Siri", "Google Assistant", "Bixby"], c: 2, d: "easy" },
            { q: "Non ML type?", a: ["Supervised", "Reinforcement", "Sequential", "Unsupervised"], c: 2, d: "medium" },
            { q: "Activation function use?", a: ["Normalize", "Overfit", "Initialize", "Non-linearity"], c: 3, d: "medium" },
            { q: "BERT by?", a: ["IBM", "Google", "Meta", "Amazon"], c: 1, d: "medium" },
            { q: "GAN stands for?", a: ["Graphical AI Network", "General Adv Network", "Generative Adversarial Network", "Generic AI Node"], c: 2, d: "medium" }
        ];

        let questions, currentIndex = 0, timer, timeLeft = 30;
        let used5050 = false, usedPhone = false, usedAudience = false;

        const questionEl = document.getElementById("question");
        const optionsEl = document.getElementById("options");
        const timerEl = document.getElementById("timer");
        const ladderEl = document.getElementById("ladder");
        const difficultyEl = document.getElementById("difficulty");
        const badgeEl = document.getElementById("badge-msg");
        const progressBar = document.getElementById("progress-bar");
        const soundCorrect = document.getElementById("soundCorrect");
        const soundWrong = document.getElementById("soundWrong");
        const soundQuestion = document.getElementById("soundQuestion");

        function startGame() {
            document.getElementById("welcome-screen").style.display = "none";
            document.getElementById("game-container").style.display = "flex";
            restartGame();
        }

        function setupLadder() {
            ladderEl.innerHTML = "";
            for (let i = prizes.length - 1; i >= 0; i--) {
                const li = document.createElement("li");
                li.textContent = `Q${i + 1}: ${prizes[i]}`;
                ladderEl.appendChild(li);
            }
        }

        function updateLadder() {
            const items = ladderEl.querySelectorAll("li");
            items.forEach((li, i) => {
                li.classList.remove("active");
                if (i === prizes.length - 1 - currentIndex) li.classList.add("active");
            });
        }

        function updateProgress() {
            const percent = ((currentIndex) / prizes.length) * 100;
            progressBar.style.width = percent + "%";
        }

        function loadQuestion() {
            clearInterval(timer);
            if (currentIndex >= questions.length) {
                confetti({ particleCount: 300, spread: 100, origin: { y: 0.6 } });
                document.getElementById("ladder-panel").style.display = "none";

                const rows = [
                    prizes.slice(0, 4),
                    prizes.slice(4, 8),
                    prizes.slice(8, 11),
                ];
                let html = `<div class="final-congrats">
                    <h2>üéâ Congratulations!</h2>
                    <p>You've completed all levels and earned the following badges:</p>`;

                rows.forEach(row => {
                    html += `<div class="badge-row">`;
                    row.forEach(p => {
                        html += `<div class="badge-box">${p}</div>`;
                    });
                    html += `</div>`;
                });

                html += `<div class="final-badge">üèÜ Final Badge: ${prizes[prizes.length - 1]}</div></div>`;
                questionEl.innerHTML = html;
                optionsEl.innerHTML = "";
                timerEl.textContent = "";
                difficultyEl.textContent = "";
                badgeEl.textContent = "";
                document.querySelectorAll(".lifeline-btn").forEach(btn => btn.style.display = "none");
                progressBar.style.width = "100%";
                return;
            }

            const q = questions[currentIndex];
            timeLeft = 30;
            updateTimer();
            timer = setInterval(() => {
                timeLeft--;
                updateTimer();
                if (timeLeft <= 0) endGame("‚è±Ô∏è Time‚Äôs up!");
            }, 1000);

            updateLadder();
            updateProgress();
            difficultyEl.textContent = `üîé Difficulty: ${q.d.charAt(0).toUpperCase() + q.d.slice(1)}`;
            questionEl.textContent = `Q${currentIndex + 1}. ${q.q}`;
            optionsEl.innerHTML = "";
            badgeEl.textContent = "";

            playSound(soundQuestion);
            q.a.forEach((option, i) => {
                const btn = document.createElement("button");
                btn.className = "option-btn";
                btn.textContent = option;
                btn.setAttribute("data-index", i);
                btn.onclick = () => handleAnswer(i);
                optionsEl.appendChild(btn);
            });
        }

        function handleAnswer(i) {
            clearInterval(timer);
            const correct = questions[currentIndex].c;
            const btns = optionsEl.querySelectorAll("button");
            btns.forEach((btn, index) => {
                btn.disabled = true;
                if (index === correct) {
                    btn.style.backgroundColor = "#28a745";
                    btn.style.boxShadow = "0 0 15px 5px #28a745";
                } else if (index === i) {
                    btn.style.backgroundColor = "#dc3545";
                    btn.style.boxShadow = "0 0 15px 5px #dc3545";
                }
            });

            if (i === correct) {
                playSound(soundCorrect);
                badgeEl.textContent = `üéñÔ∏è Badge Unlocked: ${prizes[currentIndex]}`;
                currentIndex++;
                setTimeout(loadQuestion, 2000);
            } else {
                playSound(soundWrong);
                setTimeout(() => endGame("‚ùå Wrong Answer!"), 1500);
            }
        }

        function updateTimer() {
            timerEl.textContent = `‚è±Ô∏è ${timeLeft}s`;
        }

        function endGame(msg) {
            clearInterval(timer);
            questionEl.textContent = msg;
            optionsEl.innerHTML = "";
            timerEl.textContent = "";
            difficultyEl.textContent = "";
            badgeEl.textContent = "";
        }

        function restartGame() {
            used5050 = usedPhone = usedAudience = false;
            document.querySelectorAll(".lifeline-btn").forEach(btn => {
                btn.disabled = false;
                btn.style.display = "inline-block";
            });
            questions = [...allQuestions].sort(() => 0.5 - Math.random());
            currentIndex = 0;
            setupLadder();
            updateProgress();
            loadQuestion();
        }

        function quitGame() {
            endGame("üö™ You quit the game.");
        }

        function playSound(s) {
            s.pause(); s.currentTime = 0; s.play();
        }

        function use5050() {
            if (used5050) return;
            used5050 = true;
            document.getElementById("lifeline5050").disabled = true;
            const correct = questions[currentIndex].c;
            const btns = Array.from(optionsEl.children);
            let removed = 0;
            for (let b of btns) {
                const i = parseInt(b.getAttribute("data-index"));
                if (i !== correct && removed < 2) {
                    b.disabled = true;
                    b.style.visibility = "hidden";
                    removed++;
                }
            }
        }

        function usePhone() {
            if (usedPhone) return;
            usedPhone = true;
            document.getElementById("lifelinePhone").disabled = true;
            const correct = questions[currentIndex].c;
            const i = Math.random() < 0.8 ? correct : (correct + 1) % 4;
            alert(`üìû Your friend suggests: "${questions[currentIndex].a[i]}"`);
        }

        function useAudience() {
            if (usedAudience) return;
            usedAudience = true;
            document.getElementById("lifelineAudience").disabled = true;
            const correct = questions[currentIndex].c;
            let msg = "üìä Audience Poll:\n";
            for (let i = 0; i < 4; i++) {
                msg += `Option ${String.fromCharCode(65 + i)}: ${i === correct ? 65 : Math.floor(Math.random() * 35)}%\n`;
            }
            alert(msg);
        }

        // GLB Model Script
        let scene, camera, renderer, model, head;
        const glbCanvas = document.getElementById("glb-canvas");

        // Scene Setup
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(45, (0.25 * window.innerWidth) / window.innerHeight, 0.1, 100);
        camera.position.set(0, 1.5, 3);

        renderer = new THREE.WebGLRenderer({ antialias: true, canvas: glbCanvas });
        renderer.setSize(0.25 * window.innerWidth, window.innerHeight);

        // Light
        const ambientLight = new THREE.AmbientLight(0xffffff, 1.5);
        scene.add(ambientLight);

        // GLTFLoader - using a direct implementation since we can't import modules
        class GLTFLoader {
            load(url, onLoad, onProgress, onError) {
                fetch(url)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        // This part needs a proper GLB parser library (like Three.js GLTFLoader)
                        // For a simplified example, we'll just log an error
                        return response.arrayBuffer();
                    })
                    .then(data => {
                        console.log('GLB file loaded, but parsing requires a proper GLTFLoader.');
                        // A more complete implementation would parse the GLB data here.
                        // For now, we'll call onError to indicate failure to parse.
                        if (onError) onError(new Error('GLB parsing not implemented in this simple version without Three.js GLTFLoader module.'));
                    })
                    .catch(error => {
                        console.error('Error loading GLB:', error);
                        if (onError) onError(error);
                    });
            }
        }
        
        const loader = new GLTFLoader();
        
        // Since GLB loading is complex, let's create a simple doll and show how to replace it
        function createSimpleDoll() {
            model = new THREE.Group();
            
            // Body
            const bodyGeometry = new THREE.CylinderGeometry(0.3, 0.4, 1.2, 8);
            const bodyMaterial = new THREE.MeshLambertMaterial({ color: 0xffff00 });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.y = 0.6;
            model.add(body);
            
            // Head (this will be our rotatable part)
            const headGeometry = new THREE.SphereGeometry(0.25, 16, 16);
            const headMaterial = new THREE.MeshLambertMaterial({ color: 0xffddaa });
            head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.y = 1.5;
            model.add(head);
            
            // Hair
            const hairGeometry = new THREE.SphereGeometry(0.15, 8, 8);
            const hairMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            
            const leftHair = new THREE.Mesh(hairGeometry, hairMaterial);
            leftHair.position.set(-0.2, 0.2, 0);
            head.add(leftHair);
            
            const rightHair = new THREE.Mesh(hairGeometry, hairMaterial);
            rightHair.position.set(0.2, 0.2, 0);
            head.add(rightHair);
            
            // Eyes
            const eyeGeometry = new THREE.SphereGeometry(0.03, 8, 8);
            const eyeMaterial = new THREE.MeshLambertMaterial({ color: 0x000000 });
            
            const leftEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            leftEye.position.set(-0.08, 0.05, 0.2);
            head.add(leftEye);
            
            const rightEye = new THREE.Mesh(eyeGeometry, eyeMaterial);
            rightEye.position.set(0.08, 0.05, 0.2);
            head.add(rightEye);
            
            model.scale.set(1.5, 1.5, 1.5);
            scene.add(model);
            
            console.log('Simple doll created. Replace this function with GLB loading when you have a proper GLB file.');
        }
        
        // Create simple doll for now
        createSimpleDoll();
        
        // Load external GLB model (currently shows error handling)
        // This part would ideally use a proper GLTFLoader from Three.js examples if available
        // loader.load('./doll.glb', function (gltf) {
        //     scene.remove(model);
        //     model = gltf.scene;
        //     model.scale.set(1.5, 1.5, 1.5);
        //     scene.add(model);
        //     head = model.getObjectByName('head') || model.getObjectByName('Head') || model.getObjectByName('HEAD') || model.children.find(child => child.name.toLowerCase().includes('head'));
        //     if (!head && model.children.length > 0) {
        //         head = model.children[0];
        //     }
        //     console.log('Model loaded successfully');
        //     console.log('Available objects:', model.children.map(child => child.name));
        //     console.log('Head object found:', head ? head.name : 'None');
        // }, function (progress) {
        //     console.log('Loading progress:', (progress.loaded / progress.total * 100) + '%');
        // }, function (error) {
        //     console.error('Error loading model:', error);
        //     console.log('Make sure doll.glb file is in the same directory as this HTML file. Using simple doll as fallback.');
        // });

        // OrbitControls - simple implementation
        class OrbitControls {
            constructor(camera, domElement) {
                this.camera = camera;
                this.domElement = domElement;
                this.enabled = true;
                
                let isMouseDown = false;
                let mouseX = 0, mouseY = 0;
                
                domElement.addEventListener('mousedown', (e) => {
                    isMouseDown = true;
                    mouseX = e.clientX;
                    mouseY = e.clientY;
                });
                
                domElement.addEventListener('mouseup', () => {
                    isMouseDown = false;
                });
                
                domElement.addEventListener('mousemove', (e) => {
                    if (!isMouseDown) return;
                    
                    const deltaX = e.clientX - mouseX;
                    const deltaY = e.clientY - mouseY;
                    
                    camera.position.x = Math.cos(deltaX * 0.01) * 3;
                    camera.position.z = Math.sin(deltaX * 0.01) * 3;
                    camera.lookAt(0, 1.5, 0);
                    
                    mouseX = e.clientX;
                    mouseY = e.clientY;
                });
            }
        }

        // Controls (optional for testing)
        const controls = new OrbitControls(camera, renderer.domElement);

        // Key press rotation
        window.addEventListener('keydown', (e) => {
            if (e.key.toLowerCase() === 'r' && head) {
                head.rotation.y += Math.PI / 8;
                console.log('Head rotated, current Y rotation:', head.rotation.y);
            } else if (e.key.toLowerCase() === 'r' && !head) {
                console.log('Head object not found - cannot rotate');
            }
        });

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        animate();

        // Handle resizing
        window.addEventListener('resize', () => {
            camera.aspect = (0.25 * window.innerWidth) / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(0.25 * window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
